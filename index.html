<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Baseball Tactics: Baseball IQ Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        touch-action: none; /* Prevents scrolling on mobile while dragging */
      }
      .baseball-field {
        position: relative;
        width: 100%;
        max-width: 700px;
        aspect-ratio: 1 / 1;
        background-color: #4a934a; /* Green grass */
        border-radius: 0 0 50% 50%;
        margin: auto;
        border: 4px solid #8b4513; /* Brown dirt */
        overflow: hidden;
      }
      .infield-dirt {
        position: absolute;
        width: 65%;
        height: 65%;
        background-color: #d2b48c; /* Tan dirt */
        left: 50%;
        top: 45%;
        transform: translateX(-50%) rotate(45deg);
        border-radius: 15%;
      }
      .base {
        position: absolute;
        width: 5%;
        height: 5%;
        background-color: white;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
      }
      #home-plate {
        width: 5%;
        height: 5%;
        background-color: white;
        position: absolute;
        bottom: 5%;
        left: 47.5%;
        clip-path: polygon(0 0, 100% 0, 100% 75%, 50% 100%, 0 75%);
      }
      #first-base {
        top: 50%;
        right: 25%;
        transform: translateY(-50%) rotate(45deg);
      }
      #second-base {
        top: 25%;
        left: 50%;
        transform: translateX(-50%) rotate(45deg);
      }
      #third-base {
        top: 50%;
        left: 25%;
        transform: translateY(-50%) rotate(45deg);
      }
      .pitchers-mound {
        position: absolute;
        width: 12%;
        height: 12%;
        background-color: #b8860b;
        border-radius: 50%;
        left: 44%;
        bottom: 44%;
        border: 2px solid #8b4513;
      }
      .foul-line {
        position: absolute;
        background-color: white;
        width: 2px;
        height: 65%;
      }
      #foul-line-left {
        top: 35%;
        left: 35%;
        transform: rotate(-45deg);
        transform-origin: bottom right;
      }
      #foul-line-right {
        top: 35%;
        right: 35%;
        transform: rotate(45deg);
        transform-origin: bottom left;
      }

      .player-icon,
      .runner-icon,
      .ball-icon,
      .static-player,
      .throw-option {
        position: absolute;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 14px;
        user-select: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
        transition: all 0.2s ease-in-out;
        z-index: 10;
      }

      .player-icon {
        cursor: grab;
      }
      .player-icon:active,
      .ball-icon:active {
        cursor: grabbing;
        transform: scale(1.1);
        z-index: 20;
      }

      .player-icon {
        background-color: #003366;
        border: 2px solid #ffffff;
      }
      .static-player {
        background-color: #003366;
        opacity: 0.6;
      }
      .user-player {
        background-color: #ffd700;
        color: #003366;
        border: 2px solid #003366;
        opacity: 1;
      }
      .runner-icon {
        background-color: #cc0000;
        border: 2px solid #ffffff;
        font-size: 20px;
      }
      .ball-icon {
        background-color: #fff;
        border: 2px solid #cc0000;
        color: black;
        font-size: 24px;
        padding-bottom: 4px; /* For emoji alignment */
        cursor: grab;
      }
      .throw-option {
        font-size: 24px;
        padding-bottom: 4px;
        z-index: 6; /* Above drop-zones but below dragged items */
        background-color: rgba(200, 200, 200, 0.5);
        border: 2px dashed #ffffff;
        color: black;
        opacity: 0.7;
      }
      .throw-line {
        position: absolute;
        background-color: rgba(255, 255, 255, 0.8);
        height: 3px;
        transform-origin: 0 50%;
        z-index: 5;
        display: none;
      }
      .drop-zone {
        position: absolute;
        border: 2px dashed rgba(255, 255, 255, 0.7);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        z-index: 4;
        background-color: rgba(255, 255, 255, 0.1);
      }
      .dragging {
        opacity: 0.5;
      }
      .feedback-correct {
        animation: feedback-pop 0.5s ease-out;
      }
      .feedback-incorrect {
        animation: feedback-shake 0.5s ease-out;
      }

      @keyframes feedback-pop {
        0% {
          transform: scale(0.8);
          opacity: 0;
        }
        70% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      @keyframes feedback-shake {
        0%,
        100% {
          transform: translateX(0);
        }
        20%,
        60% {
          transform: translateX(-5px);
        }
        40%,
        80% {
          transform: translateX(5px);
        }
      }

      #dugout-players .player-icon,
      #dugout-ball .ball-icon {
        position: static; /* Override absolute positioning for icons in the dugout */
      }
      .coin-change {
        position: absolute;
        right: 0;
        top: -15px;
        font-size: 1.5rem;
        font-weight: bold;
        opacity: 0;
        animation: coin-float 1s ease-out forwards;
      }
      .coin-gain {
        color: #22c55e;
      } /* Tailwind green-500 */
      .coin-loss {
        color: #ef4444;
      } /* Tailwind red-500 */

      @keyframes coin-float {
        0% {
          transform: translateY(0);
          opacity: 1;
        }
        100% {
          transform: translateY(-40px);
          opacity: 0;
        }
      }

      /* Responsive adjustments for smaller screens */
      @media (max-width: 640px) {
        .player-icon,
        .runner-icon,
        .ball-icon,
        .static-player,
        .throw-option {
          width: 32px;
          height: 32px;
          font-size: 12px;
        }
        .ball-icon,
        .throw-option {
          font-size: 18px;
          padding-bottom: 3px;
        }
        .runner-icon {
          font-size: 16px;
        }
        .drop-zone {
          width: 40px;
          height: 40px;
        }
        .coin-change {
          top: -10px;
          font-size: 1.25rem;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 flex flex-col items-center p-2 sm:p-4 min-h-screen">
    <div class="w-full max-w-7xl mx-auto">
      <h1
        class="text-2xl sm:text-3xl md:text-4xl font-bold text-center text-gray-800 mb-2"
      >
        Baseball Tactics
      </h1>
      <p class="text-center text-gray-600 mb-4 text-sm sm:text-base">
        An Interactive Baseball IQ Trainer
      </p>

      <!-- Scenario Info -->
      <div
        id="scenario-box"
        class="bg-white rounded-lg shadow-md p-4 mb-4 border-l-4 border-blue-600"
      >
        <h2 class="text-xl font-bold text-gray-800 mb-2">The Situation</h2>
        <div
          id="scenario-info"
          class="grid grid-cols-2 md:grid-cols-4 gap-2 text-gray-700"
        >
          <p><strong>Inning:</strong> <span id="inning"></span></p>
          <p><strong>Outs:</strong> <span id="outs"></span></p>
          <p><strong>Score:</strong> <span id="score"></span></p>
          <p><strong>Runners:</strong> <span id="runners"></span></p>
        </div>
        <div class="mt-3 pt-3 border-t">
          <h3 class="text-lg font-semibold text-gray-800">The Play</h3>
          <p id="play-description" class="text-gray-600"></p>
          <p
            id="user-position-info"
            class="mt-2 text-blue-700 font-semibold"
          ></p>
        </div>
      </div>

      <!-- Main Game Area -->
      <div class="flex flex-col lg:flex-row gap-4">
        <!-- Left Column -->
        <div class="w-full lg:w-72 order-3 lg:order-1 flex flex-col gap-4">
          <!-- User Profile Section -->
          <div
            id="user-profile"
            class="bg-white rounded-lg shadow-md p-4 flex flex-col gap-4"
          >
            <div class="flex items-center gap-3">
              <label
                for="player-name"
                class="font-bold text-gray-700 text-base sm:text-lg"
                >Player:</label
              >
              <input
                type="text"
                id="player-name"
                placeholder="Enter Your Name"
                class="border rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none transition w-full"
              />
            </div>

            <div class="flex items-center justify-between gap-4">
              <div id="rank-display" class="flex items-center gap-2">
                <span class="font-bold text-gray-700 text-base sm:text-lg"
                  >Rank:</span
                >
                <span
                  id="rank-level"
                  class="font-bold text-xl sm:text-2xl text-gray-800"
                  >0</span
                >
              </div>
              <div id="coin-display" class="relative flex items-center gap-2">
                <!-- Super Mario style coin icon -->
                <svg
                  class="w-8 h-8 sm:w-10 sm:h-10"
                  viewBox="0 0 100 100"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <defs>
                    <radialGradient id="coinshine" cx="0.25" cy="0.25" r="0.35">
                      <stop offset="0%" stop-color="#FFF7B6" />
                      <stop offset="100%" stop-color="#F7D957" />
                    </radialGradient>
                  </defs>
                  <circle
                    cx="50"
                    cy="50"
                    r="45"
                    fill="#F7D957"
                    stroke="#D48C2A"
                    stroke-width="5"
                  />
                  <circle
                    cx="50"
                    cy="50"
                    r="35"
                    fill="#E6A931"
                    stroke="#D48C2A"
                    stroke-width="3"
                  />
                  <path
                    d="M 50,25 59,45 80,45 64,58 70,78 50,65 30,78 36,58 20,45 41,45 Z"
                    fill="#F7D957"
                    stroke="#D48C2A"
                    stroke-width="2"
                  />
                  <circle
                    cx="50"
                    cy="50"
                    r="45"
                    fill="url(#coinshine)"
                    opacity="0.8"
                  />
                </svg>
                <span
                  id="coin-count"
                  class="font-bold text-xl sm:text-2xl text-gray-800"
                  >5</span
                >
                <span id="coin-change-text"></span>
              </div>
            </div>
          </div>
          <!-- Leaderboard Section -->
          <div
            id="leaderboard-section"
            class="w-full bg-white rounded-lg shadow-md p-4"
          >
            <h3
              class="text-xl font-bold text-center mb-4 text-gray-800 border-b pb-2"
            >
              Leaderboard
            </h3>
            <div id="leaderboard-list" class="space-y-2">
              <!-- Scores will be injected here -->
            </div>
          </div>
        </div>

        <!-- Baseball Field (Center) -->
        <div class="flex-grow order-1 lg:order-2">
          <div id="field-container" class="baseball-field">
            <div class="infield-dirt"></div>
            <div id="home-plate"></div>
            <div id="first-base" class="base"></div>
            <div id="second-base" class="base"></div>
            <div id="third-base" class="base"></div>
            <div class="pitchers-mound"></div>
            <div id="foul-line-left" class="foul-line"></div>
            <div id="foul-line-right" class="foul-line"></div>
            <div id="throw-line" class="throw-line"></div>
          </div>
        </div>

        <!-- Dugout and Controls Column (Right) -->
        <div class="w-full lg:w-72 order-2 lg:order-3">
          <div
            class="w-full bg-gray-200 p-4 rounded-lg shadow-inner flex flex-col h-full"
          >
            <div class="flex-grow">
              <h3 class="text-lg font-bold text-center mb-2">The Dugout</h3>
              <p class="text-sm text-center text-gray-600 mb-2">
                Drag key players to their positions.
              </p>
              <div
                id="dugout-players"
                class="flex justify-center gap-3 items-center mb-6 bg-gray-300 rounded-lg p-6"
              >
                <!-- Player icons to be dragged will be injected here -->
              </div>

              <h3 class="text-lg font-bold text-center mb-2">The Throw</h3>
              <p class="text-sm text-center text-gray-600 mb-2">
                Drag the ball to the correct target.
              </p>
              <div
                id="dugout-ball"
                class="flex justify-center items-center bg-gray-300 rounded-lg p-6"
              >
                <div id="ball" class="ball-icon" draggable="true">âš¾</div>
              </div>
            </div>

            <div class="mt-6 flex flex-col gap-3">
              <button
                id="submit-btn"
                class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200 shadow-md"
              >
                Submit Play
              </button>
              <button
                id="reset-btn"
                class="w-full bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition duration-200"
              >
                Reset Positions
              </button>
              <button
                id="next-scenario-btn"
                class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition duration-200"
              >
                Next Scenario
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Feedback Modal -->
      <div
        id="feedback-modal"
        class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center p-4 hidden z-50"
      >
        <div
          id="feedback-content"
          class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-lg mx-auto"
        >
          <h2 id="feedback-title" class="text-2xl font-bold mb-4"></h2>
          <p id="feedback-text" class="text-gray-700 mb-6"></p>
          <button
            id="show-answer-btn"
            class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-200"
          >
            Show Answer
          </button>
        </div>
      </div>

      <!-- Game Over Modal -->
      <div
        id="game-over-modal"
        class="fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4 hidden z-50"
      >
        <div
          class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-lg mx-auto text-center"
        >
          <h2 class="text-3xl font-bold mb-4 text-red-600">Game Over</h2>
          <p class="text-gray-700 mb-6 text-lg">You've run out of coins!</p>
          <button
            id="play-again-btn"
            class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-200 text-lg"
          >
            Play Again
          </button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM ELEMENTS ---
        const fieldContainer = document.getElementById("field-container");
        const dugoutPlayers = document.getElementById("dugout-players");
        const dugoutBall = document.getElementById("dugout-ball");
        const throwLine = document.getElementById("throw-line");
        const submitBtn = document.getElementById("submit-btn");
        const resetBtn = document.getElementById("reset-btn");
        const feedbackModal = document.getElementById("feedback-modal");
        const feedbackContent = document.getElementById("feedback-content");
        const feedbackTitle = document.getElementById("feedback-title");
        const feedbackText = document.getElementById("feedback-text");
        const showAnswerBtn = document.getElementById("show-answer-btn");
        const nextScenarioBtn = document.getElementById("next-scenario-btn");
        const coinCountElement = document.getElementById("coin-count");
        const coinChangeText = document.getElementById("coin-change-text");
        const rankLevelElement = document.getElementById("rank-level");
        const gameOverModal = document.getElementById("game-over-modal");
        const playAgainBtn = document.getElementById("play-again-btn");
        const leaderboardList = document.getElementById("leaderboard-list");

        // --- GAME STATE ---
        let currentScenarioIndex = -1;
        let draggedItem = null;
        let userPositions = {}; // { 'SS': { x, y }, 'ball': { x, y } }
        let userPlayerElement = null;
        let playerCoins = 5;
        let playerRank = 0;
        let correctAnswersCount = 0;
        let leaderboardData = [];

        // --- SCENARIO DATA ---
        const SCENARIOS_DATA = [
          {
            info: {
              inning: "Top 3rd",
              outs: "0",
              score: "Home 1 - Away 0",
              runners: "On 1st",
            },
            play: {
              description:
                "Batter hits a single to right field. Runner on 1st tries to take third.",
              userPosition: "RF",
              userPos: { x: 85, y: 30 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "3B": { x: 30, y: 60 },
              SS: { x: 40, y: 50 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
            },
            solution: {
              players: { "1B": { x: 60, y: 40 }, "2B": { x: 70, y: 65 } },
              ball: { x: 27, y: 50 },
              throwOptions: [
                { x: 27, y: 50 },
                { x: 50, y: 25 },
                { x: 75, y: 50 },
              ],
              feedback: {
                correct:
                  "Perfect! By throwing to third, you have a chance to get the lead runner. Your 1B and 2B are correctly positioned to back up and cover bases.",
                incorrect:
                  "Not quite. The primary play is at third base to stop the lead runner. Your infielders also need to be in position to cover for a potential overthrow or further play.",
              },
            },
          },
          {
            info: {
              inning: "Bot 7th",
              outs: "1",
              score: "Tied 2-2",
              runners: "On 2nd",
            },
            play: {
              description:
                "A base hit is lined into the left-center field gap. The runner on 2nd tries to score.",
              userPosition: "CF",
              userPos: { x: 35, y: 10 },
            },
            initialRunners: [{ id: "R1", pos: { x: 50, y: 25 } }],
            staticPlayers: {
              P: { x: 50, y: 60 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: {
                SS: { x: 40, y: 45 },
                LF: { x: 15, y: 20 },
                "2B": { x: 60, y: 45 },
              },
              ball: { x: 40, y: 45 },
              throwOptions: [
                { x: 40, y: 45 },
                { x: 50, y: 92 },
                { x: 60, y: 45 },
              ],
              feedback: {
                correct:
                  "Excellent! You hit the cutoff man (SS). This is fundamentally sound baseball, giving your team the best chance to make a play at the plate.",
                incorrect:
                  "That's a risky play. Trying to throw all the way home often results in a late throw, allowing the batter to advance. Always hit your cutoff man.",
              },
            },
          },
          {
            info: {
              inning: "Top 9th",
              outs: "1",
              score: "Home 3 - Away 2",
              runners: "On 1st & 3rd",
            },
            play: {
              description:
                "The batter hits a routine ground ball right to you. A double play would end the inning.",
              userPosition: "SS",
              userPos: { x: 40, y: 55 },
            },
            initialRunners: [
              { id: "R1", pos: { x: 75, y: 50 } },
              { id: "R2", pos: { x: 25, y: 50 } },
            ],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { "2B": { x: 60, y: 40 } },
              ball: { x: 60, y: 40 },
              throwOptions: [
                { x: 60, y: 40 },
                { x: 75, y: 50 },
                { x: 50, y: 92 },
              ],
              feedback: {
                correct:
                  "That's the game-saving play! You start the 6-4-3 double play, which ends the inning and secures the win. This is the highest percentage play.",
                incorrect:
                  "Getting the out at first is safe, but it allows the tying run to score from third. In this critical situation, you have to go for the double play.",
              },
            },
          },
          {
            info: {
              inning: "Bot 2nd",
              outs: "0",
              score: "Tied 0-0",
              runners: "On 1st",
            },
            play: {
              description:
                "The batter squares to bunt and lays down a bunt towards you along the foul line.",
              userPosition: "3B",
              userPos: { x: 30, y: 60 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              C: { x: 50, y: 92 },
              "2B": { x: 60, y: 55 },
              SS: { x: 40, y: 55 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { P: { x: 25, y: 50 }, "1B": { x: 65, y: 50 } },
              ball: { x: 75, y: 50 },
              throwOptions: [
                { x: 75, y: 50 },
                { x: 50, y: 25 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "Great play! You fielded the bunt and made the smart throw to first for the sure out. Your pitcher correctly covers third base in case of a rundown.",
                incorrect:
                  "This is a tricky play. While getting the lead runner at second is tempting, it's a very difficult throw. The highest percentage play is to take the guaranteed out at first base.",
              },
            },
          },
          {
            info: {
              inning: "Top 5th",
              outs: "1",
              score: "Away 2 - Home 1",
              runners: "On 2nd",
            },
            play: {
              description:
                "The batter hits a medium-deep fly ball to you. The runner on 2nd is tagging up.",
              userPosition: "CF",
              userPos: { x: 50, y: 10 },
            },
            initialRunners: [{ id: "R1", pos: { x: 50, y: 25 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { SS: { x: 40, y: 35 }, "2B": { x: 60, y: 35 } },
              ball: { x: 40, y: 35 },
              throwOptions: [
                { x: 40, y: 35 },
                { x: 25, y: 50 },
                { x: 50, y: 92 },
              ],
              feedback: {
                correct:
                  "Textbook execution! You hit your cutoff man, the shortstop. This prevents a costly overthrow and keeps the batter from advancing, while still giving you a chance to get the runner at third.",
                incorrect:
                  "Trying to throw all the way to third base is risky. If the throw is offline, the runner could score and the batter could advance to second. Always hit the cutoff man in this situation.",
              },
            },
          },
          {
            info: {
              inning: "Bot 8th",
              outs: "1",
              score: "Home 4 - Away 3",
              runners: "On 1st & 2nd",
            },
            play: {
              description:
                "A ground ball is hit sharply to your right. You move to the bag to take the throw for the force out.",
              userPosition: "SS",
              userPos: { x: 40, y: 50 },
            },
            initialRunners: [
              { id: "R1", pos: { x: 75, y: 50 } },
              { id: "R2", pos: { x: 50, y: 25 } },
            ],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { "2B": { x: 60, y: 40 } },
              ball: { x: 75, y: 50 },
              throwOptions: [
                { x: 75, y: 50 },
                { x: 25, y: 50 },
                { x: 50, y: 92 },
              ],
              feedback: {
                correct:
                  "That's the inning-ending double play! Your second baseman made the right feed, and you completed the pivot perfectly with a strong throw to first. Great teamwork!",
                incorrect:
                  "After getting the force at second, the play is always to first base for the double play. There is no force out at third or home, so throwing there would be a mistake.",
              },
            },
          },
          // --- NEW SCENARIOS ---
          {
            info: {
              inning: "Top 6th",
              outs: "2",
              score: "Tied 1-1",
              runners: "On 1st",
            },
            play: {
              description:
                "Strike three is in the dirt and gets away from you. The batter runs to first.",
              userPosition: "C",
              userPos: { x: 50, y: 92 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              "2B": { x: 60, y: 55 },
              SS: { x: 40, y: 55 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { "1B": { x: 75, y: 55 } },
              ball: { x: 75, y: 50 },
              throwOptions: [
                { x: 75, y: 50 },
                { x: 50, y: 25 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "Excellent awareness! With two outs, the batter can run even if first is occupied. Your job is to get the sure out at first base to end the inning.",
                incorrect:
                  "With two outs, the dropped third strike rule allows the batter to advance. Your only play is to get the out at first.",
              },
            },
          },
          {
            info: {
              inning: "Bot 4th",
              outs: "0",
              score: "Home 2 - Away 1",
              runners: "On 2nd",
            },
            play: {
              description:
                "A sharp single is hit directly to you. The runner from second is being waved home.",
              userPosition: "LF",
              userPos: { x: 15, y: 30 },
            },
            initialRunners: [{ id: "R1", pos: { x: 50, y: 25 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "2B": { x: 60, y: 55 },
              RF: { x: 85, y: 25 },
              CF: { x: 50, y: 10 },
            },
            solution: {
              players: { SS: { x: 40, y: 45 }, "3B": { x: 25, y: 50 } },
              ball: { x: 50, y: 92 },
              throwOptions: [
                { x: 50, y: 92 },
                { x: 40, y: 45 },
                { x: 50, y: 25 },
              ],
              feedback: {
                correct:
                  "Great throw! With a runner trying to score, you have to make a strong, accurate throw home. Your shortstop is in the correct cutoff position in case the throw is off-line.",
                incorrect:
                  "While hitting the cutoff man is usually correct, on a single with a runner trying to score from second, the throw must go home. A throw to second concedes the run.",
              },
            },
          },
          {
            info: {
              inning: "Top 8th",
              outs: "1",
              score: "Away 3 - Home 2",
              runners: "On 1st & 3rd",
            },
            play: {
              description:
                "The runner from first is stealing second. The offense is trying to bait a throw.",
              userPosition: "C",
              userPos: { x: 50, y: 92 },
            },
            initialRunners: [
              { id: "R1", pos: { x: 75, y: 50 } },
              { id: "R2", pos: { x: 25, y: 50 } },
            ],
            staticPlayers: {
              P: { x: 50, y: 53 },
              "1B": { x: 70, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: {
                "2B": { x: 60, y: 40 },
                SS: { x: 40, y: 40 },
                "3B": { x: 25, y: 55 },
              },
              ball: { x: 25, y: 55 },
              throwOptions: [
                { x: 25, y: 55 },
                { x: 50, y: 25 },
                { x: 75, y: 50 },
              ],
              feedback: {
                correct:
                  "Heads up play! You correctly identified the situation. A quick pump fake to second and looking the runner back to third is the smart play. Conceding second is better than letting the tying run score.",
                incorrect:
                  "Throwing through to second is exactly what the offense wants. This allows the runner from third to score easily. Never give up the lead run in this situation.",
              },
            },
          },
          {
            info: {
              inning: "Bot 9th",
              outs: "1",
              score: "Tied 4-4",
              runners: "Bases Loaded",
            },
            play: {
              description:
                "A slow ground ball is hit right back to you. The winning run is on third.",
              userPosition: "P",
              userPos: { x: 50, y: 53 },
            },
            initialRunners: [
              { id: "R1", pos: { x: 75, y: 50 } },
              { id: "R2", pos: { x: 50, y: 25 } },
              { id: "R3", pos: { x: 25, y: 50 } },
            ],
            staticPlayers: {
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: {
                C: { x: 50, y: 90 },
                "1B": { x: 75, y: 55 },
                SS: { x: 40, y: 40 },
                "2B": { x: 60, y: 40 },
                "3B": { x: 25, y: 55 },
              },
              ball: { x: 50, y: 90 },
              throwOptions: [
                { x: 50, y: 90 },
                { x: 75, y: 55 },
                { x: 60, y: 40 },
              ],
              feedback: {
                correct:
                  "Clutch! In a bases loaded, game-on-the-line situation, the play is always home-to-first. You get the force at home to prevent the winning run, then try for the double play.",
                incorrect:
                  "Going for the double play up the middle is tempting, but it allows the winning run to score from third. You have to get the force out at home first!",
              },
            },
          },
          {
            info: {
              inning: "Top 7th",
              outs: "0",
              score: "Home 1 - Away 0",
              runners: "On 3rd",
            },
            play: {
              description:
                "Infield is playing in. A sharp grounder is hit to you.",
              userPosition: "2B",
              userPos: { x: 65, y: 58 },
            },
            initialRunners: [{ id: "R1", pos: { x: 25, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 75, y: 60 },
              SS: { x: 35, y: 58 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: {},
              ball: { x: 50, y: 92 },
              throwOptions: [
                { x: 50, y: 92 },
                { x: 75, y: 50 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "That's the play! With the infield in, your job is to cut down the run at the plate. A strong throw home is the only option to protect the lead.",
                incorrect:
                  "Trading a run for an out is the wrong play here. With the infield in, you are committing to making the play at the plate. Throwing to first concedes the tying run.",
              },
            },
          },
          {
            info: {
              inning: "Bot 3rd",
              outs: "1",
              score: "Tied 0-0",
              runners: "On 1st",
            },
            play: {
              description:
                "A blooper is hit into shallow right field. The first baseman is going back, and the right fielder is coming in.",
              userPosition: "2B",
              userPos: { x: 60, y: 55 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              SS: { x: 40, y: 55 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
            },
            solution: {
              players: { "1B": { x: 80, y: 50 }, RF: { x: 80, y: 40 } },
              ball: { x: 75, y: 50 },
              throwOptions: [
                { x: 75, y: 50 },
                { x: 50, y: 25 },
                { x: 80, y: 45 },
              ],
              feedback: {
                correct:
                  "Excellent communication and responsibility! As the second baseman, your job is to cover first base when the first baseman vacates their position. This prevents the batter from taking an extra base.",
                incorrect:
                  "While it's tempting to go for the ball, that is the right fielder's play. If you and the first baseman both go for it, no one is covering first base.",
              },
            },
          },
          {
            info: {
              inning: "Top 5th",
              outs: "0",
              score: "Away 1 - Home 0",
              runners: "On 1st",
            },
            play: {
              description:
                "A hit-and-run is on. The runner from first breaks, and a ground ball is hit right at you.",
              userPosition: "SS",
              userPos: { x: 40, y: 55 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { "2B": { x: 55, y: 45 } },
              ball: { x: 55, y: 45 },
              throwOptions: [
                { x: 55, y: 45 },
                { x: 75, y: 50 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "Perfect read on the play! On a hit-and-run, the runner gets a huge jump. Your only play is to get the force out at second base and prevent the big inning.",
                incorrect:
                  "Throwing to first is the 'safe' play, but it puts runners on second and third with no outs because of the runner's head start. You have to go for the lead runner.",
              },
            },
          },
          {
            info: {
              inning: "Bot 9th",
              outs: "2",
              score: "Home 2 - Away 3",
              runners: "On 3rd",
            },
            play: {
              description:
                "The pitch gets by you and goes to the backstop. The runner from third breaks for home!",
              userPosition: "C",
              userPos: { x: 50, y: 92 },
            },
            initialRunners: [{ id: "R1", pos: { x: 25, y: 50 } }],
            staticPlayers: {
              "1B": { x: 70, y: 60 },
              "2B": { x: 60, y: 55 },
              SS: { x: 40, y: 55 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { P: { x: 50, y: 90 } },
              ball: { x: 50, y: 90 },
              throwOptions: [
                { x: 50, y: 90 },
                { x: 75, y: 50 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "That's how you practice it! The pitcher correctly breaks to cover home plate, and you make a quick, accurate toss to get the out and save the game. Great hustle!",
                incorrect:
                  "Trying to retrieve the ball and get back to the plate yourself is too slow. The pitcher has responsibility to cover home on a passed ball, and you must trust them to be there.",
              },
            },
          },
          {
            info: {
              inning: "Top 4th",
              outs: "0",
              score: "Tied 2-2",
              runners: "On 1st & 2nd",
            },
            play: {
              description:
                "The batter pops the ball up high in the infield near the mound.",
              userPosition: "1B",
              userPos: { x: 70, y: 60 },
            },
            initialRunners: [
              { id: "R1", pos: { x: 75, y: 50 } },
              { id: "R2", pos: { x: 50, y: 25 } },
            ],
            staticPlayers: {
              C: { x: 50, y: 92 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: {
                P: { x: 55, y: 65 },
                "3B": { x: 35, y: 65 },
                SS: { x: 45, y: 45 },
                "2B": { x: 55, y: 45 },
              },
              ball: { x: 70, y: 60 },
              throwOptions: [
                { x: 70, y: 60 },
                { x: 55, y: 60 },
                { x: 75, y: 50 },
              ],
              feedback: {
                correct:
                  "Good communication! The umpire should call 'Infield Fly, Batter's out!'. Your job is to get back to your base. The runners advance at their own risk.",
                incorrect:
                  "This is an Infield Fly Rule situation (runners on 1st and 2nd, less than 2 outs). The batter is automatically out. Do not leave your base unnecessarily.",
              },
            },
          },
          {
            info: {
              inning: "Bot 1st",
              outs: "0",
              score: "Tied 0-0",
              runners: "On 1st",
            },
            play: {
              description:
                "A long single is hit into the right-center gap. The runner on 1st will try for third.",
              userPosition: "RF",
              userPos: { x: 85, y: 25 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              SS: { x: 40, y: 55 },
              LF: { x: 15, y: 25 },
            },
            solution: {
              players: { "2B": { x: 70, y: 40 }, CF: { x: 65, y: 15 } },
              ball: { x: 70, y: 40 },
              throwOptions: [
                { x: 70, y: 40 },
                { x: 25, y: 50 },
                { x: 50, y: 25 },
              ],
              feedback: {
                correct:
                  "That's the right play! The second baseman is the correct relay man for a ball in the right-center gap. Hitting him allows for a much stronger and more accurate throw to third.",
                incorrect:
                  "A long throw all the way to third base is very difficult and likely to be offline or short. Always use your relay man to keep the double play in order and stop the runners from advancing.",
              },
            },
          },
          {
            info: {
              inning: "Bot 9th",
              outs: "1",
              score: "Home 0 - Away 1",
              runners: "On 3rd",
            },
            play: {
              description:
                "The batter squares and bunts as the runner from third breaks for home (suicide squeeze).",
              userPosition: "1B",
              userPos: { x: 70, y: 60 },
            },
            initialRunners: [{ id: "R1", pos: { x: 25, y: 50 } }],
            staticPlayers: {
              "2B": { x: 60, y: 55 },
              SS: { x: 40, y: 55 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { P: { x: 55, y: 75 }, C: { x: 50, y: 88 } },
              ball: { x: 50, y: 88 },
              throwOptions: [
                { x: 50, y: 88 },
                { x: 75, y: 50 },
                { x: 50, y: 92 },
              ],
              feedback: {
                correct:
                  "Correct positioning. On a suicide squeeze, the pitcher must field the ball and flip it to the catcher. Your job is to crash in but be ready for the throw to first if the runner is safe at home.",
                incorrect:
                  "You must cover your base. If you try to field the bunt, no one is at first. The pitcher has priority on this play. Get the out at home first!",
              },
            },
          },
          {
            info: {
              inning: "Top 2nd",
              outs: "1",
              score: "Tied 1-1",
              runners: "On 1st",
            },
            play: {
              description:
                "A hard line drive hits the pitcher's leg and caroms towards you.",
              userPosition: "3B",
              userPos: { x: 30, y: 60 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { SS: { x: 45, y: 45 }, "2B": { x: 55, y: 45 } },
              ball: { x: 55, y: 45 },
              throwOptions: [
                { x: 55, y: 45 },
                { x: 75, y: 50 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "Incredible reaction! On a broken play like this, you have to find the lead runner. Getting the force out at second is the best possible outcome.",
                incorrect:
                  "It's a chaotic play, but the out at first is the secondary option. With the ball right in the middle of the diamond, you should have time to get the lead runner at second base.",
              },
            },
          },
          {
            info: {
              inning: "Bot 6th",
              outs: "0",
              score: "Home 3 - Away 3",
              runners: "On 1st",
            },
            play: {
              description:
                "A deep fly ball is hit to the warning track. It may be off the wall.",
              userPosition: "CF",
              userPos: { x: 50, y: 10 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: {
                SS: { x: 40, y: 35 },
                LF: { x: 35, y: 15 },
                "2B": { x: 60, y: 40 },
              },
              ball: { x: 40, y: 35 },
              throwOptions: [
                { x: 40, y: 35 },
                { x: 50, y: 25 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "That's how you execute a relay. The shortstop is the correct cutoff for a ball to deep center or left-center. Hitting him ensures you keep the batter-runner from advancing and hold the other runner at third.",
                incorrect:
                  "A throw all the way to a base is a mistake. The relay system is designed to handle long throws efficiently and prevent extra bases.",
              },
            },
          },
          {
            info: {
              inning: "Top 7th",
              outs: "1",
              score: "Away 5 - Home 4",
              runners: "On 3rd",
            },
            play: {
              description:
                "The runner on third gets caught in a rundown between third and home.",
              userPosition: "3B",
              userPos: { x: 25, y: 55 },
            },
            initialRunners: [{ id: "R1", pos: { x: 35, y: 70 } }],
            staticPlayers: {
              "1B": { x: 70, y: 60 },
              "2B": { x: 60, y: 55 },
              SS: { x: 40, y: 55 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { P: { x: 40, y: 75 }, C: { x: 50, y: 88 } },
              ball: { x: 50, y: 88 },
              throwOptions: [
                { x: 50, y: 88 },
                { x: 25, y: 55 },
                { x: 40, y: 75 },
              ],
              feedback: {
                correct:
                  "Good fundamentals. In a rundown, run the runner back towards the previous base, but always throw ahead of him to the base he is running towards. Make the runner commit and keep throws to a minimum.",
                incorrect:
                  "Don't throw the ball too many times. Run directly at the runner to make them commit to a direction, then make one, decisive throw to the bag ahead of them.",
              },
            },
          },
          {
            info: {
              inning: "Bot 5th",
              outs: "1",
              score: "Home 2 - Away 2",
              runners: "None",
            },
            play: {
              description:
                "A sharp line drive is hit down the right field line. It could be a double.",
              userPosition: "RF",
              userPos: { x: 85, y: 25 },
            },
            initialRunners: [],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "3B": { x: 30, y: 60 },
              SS: { x: 40, y: 55 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
            },
            solution: {
              players: { "1B": { x: 80, y: 50 }, "2B": { x: 70, y: 40 } },
              ball: { x: 70, y: 40 },
              throwOptions: [
                { x: 70, y: 40 },
                { x: 50, y: 25 },
                { x: 75, y: 50 },
              ],
              feedback: {
                correct:
                  "Textbook play. For a ball down the right field line, the second baseman is the proper cutoff. This play keeps the batter from turning a single into a double.",
                incorrect:
                  "The first baseman is not the cutoff man on this play. Always get the ball to your relay (the 2B) to keep the runner honest.",
              },
            },
          },
          {
            info: {
              inning: "Top 9th",
              outs: "2",
              score: "Away 1 - Home 0",
              runners: "None",
            },
            play: {
              description:
                "A very slow roller is hit towards you. You need to be quick to get the out.",
              userPosition: "SS",
              userPos: { x: 40, y: 55 },
            },
            initialRunners: [],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "2B": { x: 60, y: 55 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { "1B": { x: 75, y: 55 } },
              ball: { x: 75, y: 55 },
              throwOptions: [
                { x: 75, y: 55 },
                { x: 50, y: 25 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "That's a tough play made to look easy. On a slow roller, you have to charge the ball, field it barehanded or with a quick glove-to-hand transfer, and make a strong throw to first to get the runner.",
                incorrect:
                  "Sitting back on this ball will allow the runner to beat the throw. This is a 'do-or-die' play where you must be aggressive to get the out.",
              },
            },
          },
          {
            info: {
              inning: "Bot 6th",
              outs: "1",
              score: "Tied 3-3",
              runners: "On 1st",
            },
            play: {
              description:
                "The pitch is in the dirt and blocked, but the runner on first takes off for second.",
              userPosition: "C",
              userPos: { x: 50, y: 92 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { SS: { x: 45, y: 45 }, "2B": { x: 55, y: 45 } },
              ball: { x: 50, y: 25 },
              throwOptions: [
                { x: 50, y: 25 },
                { x: 75, y: 50 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "Great recovery! After blocking the pitch, you came up firing and made a strong throw to second base. The shortstop correctly covers the bag on a steal attempt.",
                incorrect:
                  "Even after a block, you have to assume the runner is going. Be quick to your feet and make the throw. Hesitation gives the runner a free base.",
              },
            },
          },
          {
            info: {
              inning: "Top 2nd",
              outs: "2",
              score: "Home 5 - Away 0",
              runners: "Bases Loaded",
            },
            play: {
              description:
                "A routine, high fly ball is hit to you to end the inning.",
              userPosition: "LF",
              userPos: { x: 15, y: 25 },
            },
            initialRunners: [
              { id: "R1", pos: { x: 75, y: 50 } },
              { id: "R2", pos: { x: 50, y: 25 } },
              { id: "R3", pos: { x: 25, y: 50 } },
            ],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "2B": { x: 60, y: 55 },
              "3B": { x: 30, y: 60 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { SS: { x: 40, y: 40 }, CF: { x: 35, y: 15 } },
              ball: { x: 15, y: 25 },
              throwOptions: [
                { x: 15, y: 25 },
                { x: 50, y: 25 },
                { x: 50, y: 92 },
              ],
              feedback: {
                correct:
                  "Correct. The most important play is the one you're supposed to make. On a routine fly with two outs, just catch the ball. No throw is necessary.",
                incorrect:
                  "There is no reason to throw the ball anywhere. Catching the ball is the third out, which ends the inning. An unnecessary throw risks an error.",
              },
            },
          },
          {
            info: {
              inning: "Bot 7th",
              outs: "1",
              score: "Tied 1-1",
              runners: "On 2nd",
            },
            play: {
              description:
                "A wild pitch goes to the backstop. The runner on second advances to third.",
              userPosition: "C",
              userPos: { x: 50, y: 92 },
            },
            initialRunners: [{ id: "R1", pos: { x: 50, y: 25 } }],
            staticPlayers: {
              "1B": { x: 70, y: 60 },
              "2B": { x: 60, y: 55 },
              SS: { x: 40, y: 55 },
              RF: { x: 85, y: 25 },
              CF: { x: 50, y: 10 },
              LF: { x: 15, y: 25 },
            },
            solution: {
              players: { P: { x: 40, y: 75 }, "3B": { x: 25, y: 50 } },
              ball: { x: 25, y: 50 },
              throwOptions: [
                { x: 25, y: 50 },
                { x: 50, y: 25 },
                { x: 50, y: 92 },
              ],
              feedback: {
                correct:
                  "Good hustle! On a wild pitch, you have to get to the ball quickly and make a throw to third to have any chance. The pitcher correctly backs up the base to prevent an overthrow.",
                incorrect:
                  "Holding the ball concedes the base. While the runner has a good chance of being safe, you must make the throw to keep the offense honest and have a chance at an out.",
              },
            },
          },
          {
            info: {
              inning: "Top 5th",
              outs: "1",
              score: "Home 2 - Away 1",
              runners: "On 1st (fast runner)",
            },
            play: {
              description:
                "The pitcher wheels and throws to you for a pickoff attempt. The runner dives back.",
              userPosition: "1B",
              userPos: { x: 70, y: 60 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "3B": { x: 30, y: 60 },
              SS: { x: 40, y: 55 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
            },
            solution: {
              players: { "2B": { x: 65, y: 45 }, RF: { x: 80, y: 40 } },
              ball: { x: 75, y: 50 },
              throwOptions: [
                { x: 75, y: 50 },
                { x: 50, y: 25 },
                { x: 50, y: 53 },
              ],
              feedback: {
                correct:
                  "Solid defense. Your job is to catch the ball and apply a quick tag. Your second baseman and right fielder are in the correct positions to back up the play in case of an overthrow.",
                incorrect:
                  "Your only play is to tag the runner. There is no reason to throw the ball anywhere else. Secure the ball first, then make the tag.",
              },
            },
          },
          {
            info: {
              inning: "Bot 1st",
              outs: "1",
              score: "Tied 0-0",
              runners: "None",
            },
            play: {
              description:
                "Ground ball hit in the hole between you and 3B. You make a backhanded stop.",
              userPosition: "SS",
              userPos: { x: 40, y: 55 },
            },
            initialRunners: [],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "2B": { x: 60, y: 55 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { "1B": { x: 75, y: 55 } },
              ball: { x: 75, y: 55 },
              throwOptions: [
                { x: 75, y: 55 },
                { x: 50, y: 25 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "Amazing play! After a dive, you have to gather yourself and make a strong, accurate throw to first base. That's a web gem.",
                incorrect:
                  "There's no other play here. The only option is to try for the out at first. It's a tough play, but it's the right one.",
              },
            },
          },
          {
            info: {
              inning: "Top 8th",
              outs: "0",
              score: "Home 2 - Away 2",
              runners: "On 1st",
            },
            play: {
              description:
                "Bunt is laid down the first base line. You must field it.",
              userPosition: "P",
              userPos: { x: 50, y: 53 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              C: { x: 50, y: 92 },
              "3B": { x: 30, y: 60 },
              SS: { x: 40, y: 55 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { "1B": { x: 80, y: 65 }, "2B": { x: 75, y: 55 } },
              ball: { x: 50, y: 25 },
              throwOptions: [
                { x: 50, y: 25 },
                { x: 75, y: 50 },
                { x: 80, y: 65 },
              ],
              feedback: {
                correct:
                  "Smart baseball. The lead runner is the priority. Getting the force at second base is always the goal on a sacrifice bunt.",
                incorrect:
                  "Getting the out at first is easy, but it lets the opponent achieve their goal of advancing the runner. Always look for the lead runner first.",
              },
            },
          },
          {
            info: {
              inning: "Bot 2nd",
              outs: "1",
              score: "Away 1 - Home 0",
              runners: "None",
            },
            play: {
              description:
                "A high pop-up is hit behind the plate. You throw your mask off to find it.",
              userPosition: "C",
              userPos: { x: 50, y: 92 },
            },
            initialRunners: [],
            staticPlayers: {
              "2B": { x: 60, y: 55 },
              SS: { x: 40, y: 55 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: {
                P: { x: 50, y: 80 },
                "1B": { x: 65, y: 80 },
                "3B": { x: 35, y: 80 },
              },
              ball: { x: 50, y: 92 },
              throwOptions: [
                { x: 50, y: 92 },
                { x: 75, y: 50 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "Great job locating the ball! Your pitcher and corner infielders are correctly positioned to call out directions and avoid collisions. The play is simply to catch the ball.",
                incorrect:
                  "Your only job is to catch the ball. No throw is needed. Rely on your teammates to help you locate it in the air.",
              },
            },
          },
          {
            info: {
              inning: "Top 6th",
              outs: "0",
              score: "Tied 3-3",
              runners: "On 2nd",
            },
            play: {
              description:
                "The batter hits a ground ball to the shortstop, who bobbles it. The runner from 2nd tries for third.",
              userPosition: "LF",
              userPos: { x: 15, y: 25 },
            },
            initialRunners: [{ id: "R1", pos: { x: 50, y: 25 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "2B": { x: 60, y: 55 },
              "3B": { x: 30, y: 60 },
              SS: { x: 40, y: 55 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: {},
              ball: { x: 25, y: 50 },
              throwOptions: [
                { x: 25, y: 50 },
                { x: 50, y: 25 },
                { x: 75, y: 50 },
              ],
              feedback: {
                correct:
                  "Perfect backup! Your job on any ball hit to the left side is to back up third base. You are in the perfect position for an overthrow from the shortstop.",
                incorrect:
                  "Don't just watch the play. As an outfielder, you are always backing up a base or another player. On a ball to the SS, your responsibility is third base.",
              },
            },
          },
          {
            info: {
              inning: "Bot 7th",
              outs: "2",
              score: "Home 1 - Away 1",
              runners: "On 2nd",
            },
            play: {
              description:
                "A gapper is hit to deep right-center. The runner on 2nd will score, but you can keep it a double.",
              userPosition: "2B",
              userPos: { x: 60, y: 55 },
            },
            initialRunners: [{ id: "R1", pos: { x: 50, y: 25 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              SS: { x: 40, y: 55 },
              LF: { x: 15, y: 25 },
            },
            solution: {
              players: { CF: { x: 65, y: 15 }, RF: { x: 80, y: 20 } },
              ball: { x: 70, y: 40 },
              throwOptions: [
                { x: 70, y: 40 },
                { x: 50, y: 25 },
                { x: 50, y: 92 },
              ],
              feedback: {
                correct:
                  "Correct. Your responsibility is to be the relay man for the throw from the outfield. This keeps the batter at second and prevents a triple.",
                incorrect:
                  "The shortstop covers the bag. As the second baseman, your job on a ball to the right side of the field is to be the cutoff man.",
              },
            },
          },
          {
            info: {
              inning: "Top 1st",
              outs: "0",
              score: "Tied 0-0",
              runners: "None",
            },
            play: {
              description:
                "Ground ball hit right up the middle, just to your right.",
              userPosition: "P",
              userPos: { x: 50, y: 53 },
            },
            initialRunners: [],
            staticPlayers: {
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { SS: { x: 45, y: 45 }, "2B": { x: 55, y: 45 } },
              ball: { x: 50, y: 53 },
              throwOptions: [
                { x: 50, y: 53 },
                { x: 45, y: 45 },
                { x: 55, y: 45 },
              ],
              feedback: {
                correct:
                  "Good decision. Let your middle infielders make that play. It's the shortstop's ball, and trying to field it yourself often leads to errors or getting in the way.",
                incorrect:
                  "Unless the ball is hit very slowly right at you, it's almost always better to let your shortstop or second baseman field a ball up the middle. They have a better angle to throw to first.",
              },
            },
          },
          {
            info: {
              inning: "Bot 5th",
              outs: "1",
              score: "Home 2 - Away 3",
              runners: "On 3rd",
            },
            play: {
              description:
                "A fly ball is hit to medium deep center field. The runner on 3rd will tag.",
              userPosition: "SS",
              userPos: { x: 40, y: 55 },
            },
            initialRunners: [{ id: "R1", pos: { x: 25, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { "2B": { x: 60, y: 40 } },
              ball: { x: 45, y: 70 },
              throwOptions: [
                { x: 45, y: 70 },
                { x: 50, y: 25 },
                { x: 25, y: 50 },
              ],
              feedback: {
                correct:
                  "Exactly right. As the shortstop, you are the cutoff man for a throw from center field to home plate. This is a critical defensive alignment.",
                incorrect:
                  "The second baseman covers the bag. Your responsibility on a throw from center is to be the cutoff for home plate.",
              },
            },
          },
          {
            info: {
              inning: "Top 10th",
              outs: "0",
              score: "Tied 2-2",
              runners: "On 1st & 2nd (runner starts on 2B)",
            },
            play: {
              description:
                "The batter shows bunt. You are crashing from your position.",
              userPosition: "3B",
              userPos: { x: 30, y: 60 },
            },
            initialRunners: [
              { id: "R1", pos: { x: 75, y: 50 } },
              { id: "R2", pos: { x: 50, y: 25 } },
            ],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "2B": { x: 60, y: 55 },
              RF: { x: 85, y: 25 },
              CF: { x: 50, y: 10 },
              LF: { x: 15, y: 25 },
            },
            solution: {
              players: { SS: { x: 25, y: 50 } },
              ball: { x: 25, y: 50 },
              throwOptions: [
                { x: 25, y: 50 },
                { x: 75, y: 50 },
                { x: 50, y: 25 },
              ],
              feedback: {
                correct:
                  "That's the play! In an extra-inning bunt situation, getting the lead runner at third is the absolute priority to prevent the go-ahead run from getting into scoring position.",
                incorrect:
                  "Getting an out at first is the safe play but not the right one. You must try to get the lead runner at third to keep the game tied.",
              },
            },
          },
          {
            info: {
              inning: "Bot 4th",
              outs: "2",
              score: "Home 0 - Away 0",
              runners: "On 1st",
            },
            play: {
              description:
                "The runner on first is attempting to steal second on the pitch.",
              userPosition: "2B",
              userPos: { x: 60, y: 55 },
            },
            initialRunners: [{ id: "R1", pos: { x: 75, y: 50 } }],
            staticPlayers: {
              P: { x: 50, y: 53 },
              C: { x: 50, y: 92 },
              "1B": { x: 70, y: 60 },
              "3B": { x: 30, y: 60 },
              LF: { x: 15, y: 25 },
              CF: { x: 50, y: 10 },
              RF: { x: 85, y: 25 },
            },
            solution: {
              players: { SS: { x: 50, y: 40 } },
              ball: { x: 50, y: 25 },
              throwOptions: [
                { x: 50, y: 25 },
                { x: 75, y: 50 },
                { x: 50, y: 92 },
              ],
              feedback: {
                correct:
                  "Correct positioning. The shortstop covers on a steal, but your job is to back them up from behind the base in case of a bad throw from the catcher.",
                incorrect:
                  "It's the shortstop's job to cover the bag on a steal attempt. Your role is to be the backup on the play.",
              },
            },
          },
        ];

        // --- DRAG & DROP LOGIC (NO CHANGES) ---
        function setupDragEvents(element) {
          element.addEventListener("dragstart", (e) => {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add("dragging"), 0);
          });
          element.addEventListener("dragend", (e) => {
            e.target.classList.remove("dragging");
            draggedItem = null;
          });
        }
        fieldContainer.addEventListener("dragover", (e) => {
          e.preventDefault();
        });
        fieldContainer.addEventListener("drop", (e) => {
          e.preventDefault();
          if (draggedItem) {
            const fieldRect = fieldContainer.getBoundingClientRect();
            const x = e.clientX - fieldRect.left;
            const y = e.clientY - fieldRect.top;
            draggedItem.style.left = `${x - draggedItem.offsetWidth / 2}px`;
            draggedItem.style.top = `${y - draggedItem.offsetHeight / 2}px`;
            fieldContainer.appendChild(draggedItem);
            const xPercent = (x / fieldRect.width) * 100;
            const yPercent = (y / fieldRect.height) * 100;
            userPositions[draggedItem.dataset.id] = {
              x: xPercent,
              y: yPercent,
            };
            if (draggedItem.dataset.id === "ball") {
              updateThrowLine();
            }
          }
        });

        // --- TOUCH DRAG & DROP LOGIC (NO CHANGES) ---
        let touchOffsetX = 0;
        let touchOffsetY = 0;
        function setupTouchEvents(element) {
          element.addEventListener(
            "touchstart",
            (e) => {
              draggedItem = e.target;
              draggedItem.classList.add("dragging");
              const touch = e.targetTouches[0];
              const rect = draggedItem.getBoundingClientRect();
              touchOffsetX = touch.clientX - rect.left;
              touchOffsetY = touch.clientY - rect.top;
              fieldContainer.appendChild(draggedItem);
            },
            { passive: false }
          );
          element.addEventListener(
            "touchmove",
            (e) => {
              if (draggedItem) {
                e.preventDefault();
                const touch = e.targetTouches[0];
                const fieldRect = fieldContainer.getBoundingClientRect();
                let x = touch.clientX - fieldRect.left - touchOffsetX;
                let y = touch.clientY - fieldRect.top - touchOffsetY;
                x = Math.max(
                  0,
                  Math.min(x, fieldRect.width - draggedItem.offsetWidth)
                );
                y = Math.max(
                  0,
                  Math.min(y, fieldRect.height - draggedItem.offsetHeight)
                );
                draggedItem.style.left = `${x}px`;
                draggedItem.style.top = `${y}px`;
              }
            },
            { passive: false }
          );
          element.addEventListener("touchend", (e) => {
            if (draggedItem) {
              draggedItem.classList.remove("dragging");
              const fieldRect = fieldContainer.getBoundingClientRect();
              const finalX =
                parseFloat(draggedItem.style.left) +
                draggedItem.offsetWidth / 2;
              const finalY =
                parseFloat(draggedItem.style.top) +
                draggedItem.offsetHeight / 2;
              const xPercent = (finalX / fieldRect.width) * 100;
              const yPercent = (finalY / fieldRect.height) * 100;
              userPositions[draggedItem.dataset.id] = {
                x: xPercent,
                y: yPercent,
              };
              if (draggedItem.dataset.id === "ball") {
                updateThrowLine();
              }
              draggedItem = null;
            }
          });
        }

        // --- HELPER FUNCTIONS ---
        function createPlayerIcon(id, isDraggable = false, isUser = false) {
          const player = document.createElement("div");
          player.id = id.toLowerCase();
          player.dataset.id = id;
          player.textContent = id;
          if (isDraggable) {
            player.className = isUser
              ? "user-player player-icon"
              : "player-icon";
            player.setAttribute("draggable", "true");
            setupDragEvents(player);
            setupTouchEvents(player);
          } else {
            player.className = isUser
              ? "user-player static-player"
              : "static-player";
          }
          return player;
        }
        function createDropZone(id, pos) {
          const zone = document.createElement("div");
          zone.className = "drop-zone";
          zone.style.left = `${pos.x}%`;
          zone.style.top = `${pos.y}%`;
          zone.style.transform = "translate(-50%, -50%)";
          return zone;
        }

        // --- GAME LOGIC ---
        function loadScenario(scenario) {
          // Clear previous state
          fieldContainer
            .querySelectorAll(
              ".player-icon, .runner-icon, .ball-icon, .static-player, .drop-zone, .throw-option"
            )
            .forEach((el) => el.remove());
          dugoutPlayers.innerHTML = "";
          dugoutBall.innerHTML =
            '<div id="ball" class="ball-icon" draggable="true" data-id="ball">âš¾</div>';
          const ball = document.getElementById("ball");
          setupDragEvents(ball);
          setupTouchEvents(ball);
          userPositions = {};
          throwLine.style.display = "none";

          // Update info panel
          document.getElementById("inning").textContent = scenario.info.inning;
          document.getElementById("outs").textContent = scenario.info.outs;
          document.getElementById("score").textContent = scenario.info.score;
          document.getElementById("runners").textContent =
            scenario.info.runners;
          document.getElementById("play-description").textContent =
            scenario.play.description;
          document.getElementById(
            "user-position-info"
          ).textContent = `You are the ${scenario.play.userPosition}.`;

          // Add static (pre-positioned) players
          for (const pos in scenario.staticPlayers) {
            const icon = createPlayerIcon(pos, false, false);
            icon.style.left = `${scenario.staticPlayers[pos].x}%`;
            icon.style.top = `${scenario.staticPlayers[pos].y}%`;
            icon.style.transform = "translate(-50%, -50%)";
            fieldContainer.appendChild(icon);
          }

          // Add draggable players to dugout and drop zones to field
          for (const pos in scenario.solution.players) {
            const icon = createPlayerIcon(pos, true, false);
            dugoutPlayers.appendChild(icon);
            const dropZone = createDropZone(
              pos,
              scenario.solution.players[pos]
            );
            fieldContainer.appendChild(dropZone);
          }

          // Add throw option targets to the field
          scenario.solution.throwOptions.forEach((option) => {
            const target = document.createElement("div");
            target.className = "throw-option";
            target.textContent = "âš¾";
            target.style.left = `${option.x}%`;
            target.style.top = `${option.y}%`;
            target.style.transform = "translate(-50%, -50%)";
            fieldContainer.appendChild(target);
          });

          // Place user player (fixed position)
          userPlayerElement = createPlayerIcon(
            scenario.play.userPosition,
            false,
            true
          );
          userPlayerElement.style.left = `${scenario.play.userPos.x}%`;
          userPlayerElement.style.top = `${scenario.play.userPos.y}%`;
          userPlayerElement.style.transform = "translate(-50%, -50%)";
          fieldContainer.appendChild(userPlayerElement);

          // Place runners
          scenario.initialRunners.forEach((runnerInfo) => {
            const runner = document.createElement("div");
            runner.className = "runner-icon";
            runner.textContent = "R";
            runner.style.left = `${runnerInfo.pos.x}%`;
            runner.style.top = `${runnerInfo.pos.y}%`;
            runner.style.transform = "translate(-50%, -50%)";
            fieldContainer.appendChild(runner);
          });
        }

        function nextScenario() {
          currentScenarioIndex =
            (currentScenarioIndex + 1) % SCENARIOS_DATA.length;
          loadScenario(SCENARIOS_DATA[currentScenarioIndex]);
          feedbackModal.classList.add("hidden");
          feedbackModal.classList.remove("flex");
        }

        function updateThrowLine() {
          if (!userPlayerElement) return;
          const userRect = userPlayerElement.getBoundingClientRect();
          const fieldRect = fieldContainer.getBoundingClientRect();

          const ballElem = document.getElementById("ball");
          if (!ballElem || !fieldContainer.contains(ballElem)) return;
          const ballRect = ballElem.getBoundingClientRect();

          const startX = userRect.left + userRect.width / 2 - fieldRect.left;
          const startY = userRect.top + userRect.height / 2 - fieldRect.top;
          const endX = ballRect.left + ballRect.width / 2 - fieldRect.left;
          const endY = ballRect.top + ballRect.height / 2 - fieldRect.top;

          const distance = Math.sqrt(
            (endX - startX) ** 2 + (endY - startY) ** 2
          );
          const angle =
            Math.atan2(endY - startY, endX - startX) * (180 / Math.PI);

          throwLine.style.width = `${distance}px`;
          throwLine.style.left = `${startX}px`;
          throwLine.style.top = `${startY}px`;
          throwLine.style.transform = `rotate(${angle}deg)`;
          throwLine.style.display = "block";
        }

        function checkSolution() {
          const scenario = SCENARIOS_DATA[currentScenarioIndex];
          const solutionPlayers = scenario.solution.players;
          const solutionBall = scenario.solution.ball;

          let correctPlacements = 0;
          let totalPlacements = Object.keys(solutionPlayers).length;
          if (totalPlacements === 0) {
            correctPlacements = 1;
            totalPlacements = 1;
          } // Handle scenarios with no draggable players
          let isBallCorrect = false;
          const tolerance = 10; // 10% tolerance radius

          // Check player positions
          for (const pos in solutionPlayers) {
            if (userPositions[pos]) {
              const dx = userPositions[pos].x - solutionPlayers[pos].x;
              const dy = userPositions[pos].y - solutionPlayers[pos].y;
              if (Math.sqrt(dx * dx + dy * dy) < tolerance) {
                correctPlacements++;
              }
            }
          }

          // Check ball position
          if (userPositions.ball) {
            const dx = userPositions.ball.x - solutionBall.x;
            const dy = userPositions.ball.y - solutionBall.y;
            if (Math.sqrt(dx * dx + dy * dy) < tolerance) {
              isBallCorrect = true;
            }
          }

          // Require ALL players AND the ball to be correct
          if (isBallCorrect && correctPlacements === totalPlacements) {
            showFeedback(true, scenario.solution.feedback.correct);
            playerCoins++;
            correctAnswersCount++;
            if (
              correctAnswersCount > 0 &&
              correctAnswersCount % 2 === 0 &&
              playerRank < 10
            ) {
              playerRank++;
              updateRankDisplay();
            }
            triggerCoinAnimation(true);
          } else {
            if (playerCoins > 1) {
              showFeedback(false, scenario.solution.feedback.incorrect);
              playerCoins--;
              triggerCoinAnimation(false);
            } else {
              playerCoins = 0;
              triggerCoinAnimation(false);
              gameOver();
            }
          }
          updateCoinDisplay();
        }

        function gameOver() {
          const playerNameInput = document.getElementById("player-name");
          const playerName = playerNameInput.value.trim() || "Anonymous";

          leaderboardData.push({ name: playerName, rank: playerRank });
          saveLeaderboard();
          updateLeaderboardDisplay();

          feedbackModal.classList.add("hidden");
          feedbackModal.classList.remove("flex");
          gameOverModal.classList.remove("hidden");
          gameOverModal.classList.add("flex");
        }

        function resetGame() {
          playerCoins = 5;
          playerRank = 0;
          correctAnswersCount = 0;
          updateCoinDisplay();
          updateRankDisplay();
          gameOverModal.classList.add("hidden");
          gameOverModal.classList.remove("flex");
          nextScenario();
        }

        function triggerCoinAnimation(isGain) {
          coinChangeText.textContent = isGain ? "+1" : "-1";
          // Reset animation
          coinChangeText.className = "";
          void coinChangeText.offsetWidth; // Trigger reflow

          coinChangeText.className = `coin-change ${
            isGain ? "coin-gain" : "coin-loss"
          }`;
        }

        function updateCoinDisplay() {
          coinCountElement.textContent = playerCoins;
          const coinDisplay = document.getElementById("coin-display");
          coinDisplay.classList.remove("feedback-pop");
          void coinDisplay.offsetWidth; // Trigger reflow to restart animation
          coinDisplay.classList.add("feedback-pop");
        }

        function updateRankDisplay() {
          rankLevelElement.textContent = playerRank;
        }

        function showFeedback(isCorrect, text) {
          feedbackTitle.textContent = isCorrect
            ? "Correct!"
            : "Needs Improvement";
          feedbackText.textContent = text;
          feedbackContent.className = `bg-white rounded-lg shadow-2xl p-6 w-full max-w-lg mx-auto ${
            isCorrect
              ? "feedback-correct border-t-4 border-green-500"
              : "feedback-incorrect border-t-4 border-red-500"
          }`;
          feedbackModal.classList.remove("hidden");
          feedbackModal.classList.add("flex");
        }

        function saveLeaderboard() {
          localStorage.setItem(
            "baseballTacticsLeaderboard",
            JSON.stringify(leaderboardData)
          );
        }

        function loadLeaderboard() {
          const savedData = localStorage.getItem("baseballTacticsLeaderboard");
          if (savedData) {
            leaderboardData = JSON.parse(savedData);
          }
          updateLeaderboardDisplay();
        }

        function updateLeaderboardDisplay() {
          leaderboardList.innerHTML = "";
          leaderboardData.sort((a, b) => b.rank - a.rank);
          const topScores = leaderboardData.slice(0, 10);

          if (topScores.length === 0) {
            leaderboardList.innerHTML = `<p class="text-center text-gray-500">Play a game to get on the board!</p>`;
            return;
          }

          topScores.forEach((score, index) => {
            const scoreElement = document.createElement("div");
            scoreElement.className =
              "flex justify-between items-center p-2 rounded-lg";
            scoreElement.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="font-bold text-gray-600 w-6 text-sm">${
                              index + 1
                            }.</span>
                            <span class="font-semibold text-gray-800 truncate">${
                              score.name
                            }</span>
                        </div>
                        <span class="font-bold text-blue-600 text-sm">Rank: ${
                          score.rank
                        }</span>
                    `;
            leaderboardList.appendChild(scoreElement);
          });
        }

        function showCorrectSolution(solution) {
          fieldContainer
            .querySelectorAll(".drop-zone")
            .forEach((dz) => (dz.style.opacity = "0"));
          fieldContainer
            .querySelectorAll(".throw-option")
            .forEach((to) => (to.style.display = "none"));

          // Show where players should have been
          for (const pos in solution.players) {
            let playerElem = document.getElementById(pos.toLowerCase());
            if (playerElem) {
              playerElem.style.transition = "all 0.5s ease-in-out";
              playerElem.style.left = `${solution.players[pos].x}%`;
              playerElem.style.top = `${solution.players[pos].y}%`;
              playerElem.style.transform = "translate(-50%, -50%) scale(1.1)";
              playerElem.style.border = "3px solid #34D399";
            }
          }
          // Show where ball should have been
          let ballElem = document.getElementById("ball");
          if (ballElem) {
            ballElem.style.transition = "all 0.5s ease-in-out";
            ballElem.style.left = `${solution.ball.x}%`;
            ballElem.style.top = `${solution.ball.y}%`;
            ballElem.style.transform = "translate(-50%, -50%) scale(1.1)";
            ballElem.style.border = "3px solid #34D399";

            // Show correct throw option
            const correctTarget = document.createElement("div");
            correctTarget.className = "throw-option";
            correctTarget.textContent = "âš¾";
            correctTarget.style.left = `${solution.ball.x}%`;
            correctTarget.style.top = `${solution.ball.y}%`;
            correctTarget.style.transform = "translate(-50%, -50%)";
            correctTarget.style.borderColor = "#34D399";
            correctTarget.style.opacity = "1";
            fieldContainer.appendChild(correctTarget);

            updateThrowLine();
          }
        }

        // --- EVENT LISTENERS ---
        submitBtn.addEventListener("click", checkSolution);
        resetBtn.addEventListener("click", () =>
          loadScenario(SCENARIOS_DATA[currentScenarioIndex])
        );
        nextScenarioBtn.addEventListener("click", nextScenario);
        playAgainBtn.addEventListener("click", resetGame);
        showAnswerBtn.addEventListener("click", () => {
          feedbackModal.classList.add("hidden");
          feedbackModal.classList.remove("flex");
          const scenario = SCENARIOS_DATA[currentScenarioIndex];
          showCorrectSolution(scenario.solution);
        });

        // --- INITIALIZE GAME ---
        loadLeaderboard();
        updateCoinDisplay();
        updateRankDisplay();
        nextScenario(); // Load the first scenario
      });
    </script>
  </body>
</html>
