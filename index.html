<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Baseball Quiz</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      #field {
        width: 600px;
        height: 600px;
        background: green;
        margin: auto;
        position: relative;
      }
      .player {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: white;
        border: 2px solid black;
        position: absolute;
        text-align: center;
        line-height: 40px;
        cursor: grab;
      }
      #controls {
        margin: 15px;
      }
      #scenario {
        font-weight: bold;
        margin: 10px;
      }
      #score {
        margin: 10px;
      }
      #timer {
        margin: 10px;
        font-weight: bold;
      }
      button {
        margin: 5px;
        padding: 8px 16px;
      }
    </style>
  </head>
  <body>
    <h1>⚾ Baseball Quiz</h1>
    <div id="controls">
      <button onclick="setMode('easy')">Easy Mode</button>
      <button onclick="setMode('hard')">Hard Mode</button>
      <button onclick="toggleTimer()">Toggle Timer</button>
      <button onclick="nextScenario()">Next Scenario</button>
      <button onclick="resetGame()">Reset</button>
    </div>
    <div id="scenario">Loading scenario...</div>
    <div id="timer"></div>
    <div id="score">Score: 0</div>
    <div id="field"></div>

    <script>
      const players = ["P", "C", "1B", "2B", "3B", "SS", "LF", "CF", "RF"];
      let currentScenario = null;
      let scenarios = [];
      let score = 0;
      let mode = "easy";
      let useTimer = false;
      let timerInterval = null;
      let timeLeft = 30;

      function createPlayers() {
        const field = document.getElementById("field");
        field.innerHTML = "";
        players.forEach((p, i) => {
          const div = document.createElement("div");
          div.className = "player";
          div.innerText = p;
          div.style.left = 50 + (i % 3) * 180 + "px";
          div.style.top = 50 + Math.floor(i / 3) * 150 + "px";
          div.draggable = true;
          div.ondragstart = (e) => {
            e.dataTransfer.setData("text", p);
          };
          field.appendChild(div);
        });
      }

      async function loadScenarios() {
        try {
          const res = await fetch("scenarios.json");
          if (res.ok) {
            scenarios = await res.json();
          }
        } catch (err) {
          // fallback if no scenarios.json
          scenarios = [
            {
              text: "Runner on 1st, grounder to 2B → double play attempt.",
              targets: [
                { player: "2B", xMin: 200, xMax: 260, yMin: 280, yMax: 340 },
                { player: "SS", xMin: 240, xMax: 300, yMin: 300, yMax: 360 },
                { player: "1B", xMin: 330, xMax: 400, yMin: 340, yMax: 400 },
              ],
            },
          ];
        }
        nextScenario();
      }

      function setMode(m) {
        mode = m;
        alert("Mode set to " + m);
      }

      function toggleTimer() {
        useTimer = !useTimer;
        if (useTimer) startTimer();
        else stopTimer();
      }

      function startTimer() {
        timeLeft = 30;
        document.getElementById("timer").innerText = "Time: " + timeLeft;
        timerInterval = setInterval(() => {
          timeLeft--;
          document.getElementById("timer").innerText = "Time: " + timeLeft;
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            checkAnswer();
          }
        }, 1000);
      }

      function stopTimer() {
        clearInterval(timerInterval);
        document.getElementById("timer").innerText = "";
      }

      function nextScenario() {
        if (useTimer) stopTimer();
        createPlayers();
        currentScenario =
          scenarios[Math.floor(Math.random() * scenarios.length)];
        document.getElementById("scenario").innerText = currentScenario.text;
        if (useTimer) startTimer();
      }

      function resetGame() {
        score = 0;
        document.getElementById("score").innerText = "Score: " + score;
        nextScenario();
      }

      function checkAnswer() {
        const field = document.getElementById("field");
        let correct = 0;
        currentScenario.targets.forEach((t) => {
          const el = [...field.children].find((e) => e.innerText === t.player);
          if (!el) return;
          const rect = el.getBoundingClientRect();
          const fieldRect = field.getBoundingClientRect();
          const x = rect.left - fieldRect.left;
          const y = rect.top - fieldRect.top;
          if (x >= t.xMin && x <= t.xMax && y >= t.yMin && y <= t.yMax) {
            correct++;
          }
        });
        if (
          (mode === "easy" && correct >= 1) ||
          (mode === "hard" && correct === currentScenario.targets.length)
        ) {
          score++;
          alert("✅ Correct!");
        } else {
          alert("❌ Wrong play!");
        }
        document.getElementById("score").innerText = "Score: " + score;
        nextScenario();
      }

      // Initialize
      createPlayers();
      loadScenarios();
    </script>
  </body>
</html>
